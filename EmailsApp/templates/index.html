<!DOCTYPE html>
<html lang="en">

<head>
   <meta content="" name="description">
    <meta content="" name="keywords">
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- CDNs -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    
<title>Emails Data</title>
</head>


<body  style="margin-right: 20px;margin-left: 20px">
    <div style="width:100% ; overflow-x: hidden">


  <h1 style="font-size:40px ;font-family: 'Josefin Sans', sans-serif" class="title-5 ml-5 mt-3 text-center">Liste des
    Emails </h1>

     <form method="post" action="{% url 'index' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="row">

      <div class="input-group mb-3 w-25 ml-3 float-sm-left ">
        <div class="custom-file">
          <input type="file" class="custom-file-input" id="inputGroupFile02" name="datafile" >
          <label class="custom-file-label" for="inputGroupFile02">Choose file</label>
        </div>
        <div class="input-group-append">
          <button type="submit" class="input-group-text" >Import New Data</button>
        </div>
      </div>
      </div>
     
      </form>
      
      <form id="getForm" action="" method="get">
        <div class="row" id="wrapper">
          <div class="col">
            <div class="input-group input-group-sm" >
              <div class="input-group-prepend">
                <label class="input-group-text" for="gender">Gender</label>
              </div>
              <select class="custom-select" id="gender">
                <option selected> </option>
                <option value="female">Female</option>
                <option value="male">Male</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="input-group input-group-sm" >
              <div class="input-group-prepend">
                <label class="input-group-text" for="age">Age</label>
              </div>
              <select class="custom-select" id="age">
                <option selected> </option>
                <option value="lt=20">&lt20</option>
                <option value="range=20__30">20-30</option>
                <option value="range=31__40">31-40</option>
                <option value="range=41__50">41-50</option>
                <option value="range=51__60">51-60</option>
                <option value="gt=60">&gt60</option>

                {% for item in list_age %}
                <option value="{{ item }}"  >{{ item }}</option>
              {% endfor %}  
              </select>
            </div>
          </div>
          <div class="col" >
            <div class="input-group input-group-sm">
              <div class="input-group-prepend">
                <label class="input-group-text" for="job_role" >Job role/niche</label>
              </div>
              <select class="custom-select" id="job_role" name="job_role" form="getForm" >
                <option> </option>
                {% for item in list_job_title_role %}
                  <option value="{{ item }}" style="text-transform: capitalize" >{{ item }}</option>
                {% endfor %}           
              </select>
            </div>           
          </div>
          <div class="col">
            <div class="input-group input-group-sm">
              <div class="input-group-prepend">
                <label class="input-group-text" for="job_sub_role">Job sub role</label>
              </div>
              <select class="custom-select" id="job_sub_role" name="job_sub_role" form="getForm">
                <option> </option>

              </select>
            </div>                   
          </div>
           <div class="col">
            <div class="input-group input-group-sm">
              <div class="input-group-prepend">
                <label class="input-group-text" for="continent">Continent</label>
              </div>
              <select class="custom-select" id="continent" name="continent" >
                <option> </option>
                <option value="africa">Africa</option>
                <option value="asia">Asia</option>
                <option value="europe">Europe</option>
                <option value="oceania">Oceania</option>
                <option value="north">North America</option>
                <option value="south">South America</option>            
              </select>
            </div>          
          </div>
           <div class="col">
            <div class="input-group input-group-sm">
              <div class="input-group-prepend">
                <label class="input-group-text" for="country">Country</label>
              </div>
              <select class="custom-select" id="country" name="country">
                <option> </option>
                
              </select>
            </div>                      
          </div>
           <div class="col">
            <div class="input-group input-group-sm">
              <div class="input-group-prepend">
                <label class="input-group-text" for="language">Language</label>
              </div>
              <select class="custom-select" id="language" name="language">
                <option> </option>
                {% for item in list_language %}
                  <option value="{{ item }}" style="text-transform: capitalize">{{ item }}</option>
                {% endfor %}           
              </select>
            </div>            
          </div>
           <div class="col">
            <a href=""><button class="au-btn au-btn-icon au-btn--blue au-btn--small">
              <i class="fad fa-download"></i>Telecharger CSV</button> </a>   
                      </div>
           
        </div>
      </form>


  <div class="table-data__tool">

   

      <div class="table-data__tool-left">
      <p id="count">Total : 0</p>    
    </div>
  </div>

  <div class="table-responsive table-responsive-data2">
    <table class="table table-data2 table-sm" id="DataTable" style="table-layout:fixed;word-wrap:break-word;">
      <thead class="table-dark">
        <tr>

          <th style=" color:White">Full name</th>
          <th style="color:White;width:85px">Gender</th>
          <th style="color:White;width:60px">Age</th>
          <th style="color:White">Job title</th>
          <th style="color:White">Job title role</th>
          <th style="color:White">Job title sub role</th>
          <th style="color:White">Continent</th>
          <th style="color:White">Country</th>
          <th style="color:White;width:105px">Language</th>
          <th style="color:White">Emails <button style="background-color:transparent; border: none; cursor:pointer;"  class="CopyColumn" data-target=".emails" >  <i class="fa-regular fa-copy" style="color:white"></i></button>  
          </th>
        </tr>
      </thead>
      <tbody id='DataTabletBody'>

      </tbody>
    </table>
  </div>

 
      
      </div>
    </div>
  </div>
  <script>
    //LINKED DROPDOWN LISTS FOR job_role AND job_sub_role :
    document.getElementById("job_role").addEventListener("change",function(){
        document.getElementById("job_sub_role").innerHTML="";
        document.getElementById("DataTabletBody").innerHTML="";
        $.ajax({
          type:'GET',
          url:"getJobSubRole/",
          data:{
              job_role:$("#job_role").val(),
          },
          dataType:'json',
          success:function(response){
              var select=document.getElementById("job_sub_role");
              var emptyOption = document.createElement("option");
              emptyOption.innerHTML = " "
              select.appendChild(emptyOption)
              for(var i=0; i<response.list_job_title_sub_role.length;i++){
                var option = document.createElement("option");
                option.value = response.list_job_title_sub_role[i];
                option.innerHTML = response.list_job_title_sub_role[i].replace("_"," ");
                option.style.textTransform= "capitalize";
                select.appendChild(option);
              }
             
             
          },
        });
    });
  //LINKED DROPDOWN LISTS FOR Continent AND Country :

          document.getElementById("continent").addEventListener("change",function(){
            document.getElementById("country").innerHTML="";
            $.ajax({
              type:'GET',
              url:"getCountry/",
              data:{
                continent:$("#continent").val(),
              },
              dataType:'json',
              success:function(response){
                  var select=document.getElementById("country");
              var emptyOption = document.createElement("option");
              emptyOption.innerHTML = " "
              select.appendChild(emptyOption)
                  for(var i=0; i<response.list_countries.length;i++){
                    var option = document.createElement("option");
                    option.value = response.list_countries[i];
                    option.innerHTML = response.list_countries[i];
                    option.style.textTransform= "capitalize";
                    select.appendChild(option);
                  }
    
              },
            });
        });
        // SEND FORM 
        document.getElementById("wrapper").addEventListener("change",function(){

          document.getElementById("DataTabletBody").innerHTML="";

          $.ajax({
            type:'GET',
            url:"getResults/",
            data:{
              gender:$("#gender").val(),
              age:$("#age").val(),
              job_role:$("#job_role").val(),
              job_sub_role:$("#job_sub_role").val(),
              continent:$("#continent").val(),
              country:$("#country").val(),
              language:$("#language").val(),
            },
            dataType:'json',
            success:function(response){
                console.log(response.count)
                console.log(response.data)
                document.getElementById("count").innerHTML="Total : "+response.count;

             
              for(var i=0; i<response.data.length;i++){
              
              $('#DataTable').append(`<tr><td >${response.data[i].full_name}</td><td >${response.data[i].gender}</td><td >${response.data[i].age}</td><td >${response.data[i].job_title}</td><td >${response.data[i].job_title_role}</td><td >${response.data[i].job_title_sub_role}</td><td >${response.data[i].location_continent}</td><td >${response.data[i].location_country}</td><td >${response.data[i].languages}</td><td class="emails">${response.all_emails[i].join(',<br>')}</td></tr>`);
              }
             
  
            },
          });
        })
        $(document).ready(function() {

          $(".CopyColumn").click(function(){
  
              var btn = $(this);
  
              // Disable the button whilst the clipboard copy is performed
              btn.prop("disabled", true);
  
              var colData = "";
  
              // Use a line break to seperate the column data if no separator is specified
              var colSeparator = (btn.data("separator")===undefined) ? "\n" : btn.data("separator");
  
              // Loop through all elements with the target class
              $(btn.data("target")).each(function() {
                  // Collect the column data and add the separator
                  colData += $(this).text() + colSeparator;
              });
  
              // Copy the column data to the clipboard
              copyToClipboard(colData.trim());
  
              // Make a copy of the button text
              var btn_txt = btn.html();
  
              // Change the button text to "Copied"
              btn.html("Copied");
  
              // Revert the button text after 1.5 seconds
              setTimeout(function(){
                  btn.html(btn_txt);
                  // Enable the button
                  btn.prop("disabled", false);
              },1500);
  
          });
  
      });
  
      function copyToClipboard(text) {
          if (window.clipboardData && window.clipboardData.setData) {
              // IE specific code path to prevent textarea being shown while dialog is visible.
              return clipboardData.setData("Text", text); 
          } else if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
              var textarea = document.createElement("textarea");
              textarea.textContent = text;
              textarea.style.position = "fixed";  // Prevent scrolling to bottom of page in MS Edge.
              document.body.appendChild(textarea);
              textarea.select();
              try {
                  return document.execCommand("copy");  // Security exception may be thrown by some browsers.
              } catch (ex) {
                  console.warn("Copy to clipboard failed.", ex);
                  return false;
              } finally {
                  document.body.removeChild(textarea);
              }
          }
      }
                  </script>

</body>


</html>